<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Elastisched</title>
    <link rel="stylesheet" href="./css/styles.css" />
  </head>
  <body>
    <div class="page">
      <header class="topbar">
        <div class="brand">
          <div class="logo">E</div>
          <div>
            <div class="title" id="brandTitle">Elastisched</div>
            <div class="subtitle" id="brandSubtitle">Schedule at a glance</div>
          </div>
        </div>
        <div class="controls">
          <button class="ghost icon settings" id="settingsBtn" title="Settings">‚öô</button>
          <button class="ghost icon help" id="helpBtn" title="Keyboard shortcuts">?</button>
        </div>
      </header>

      <div class="modal" id="settingsModal" aria-hidden="true">
        <div class="modal-backdrop" id="settingsBackdrop"></div>
        <section class="panel form-panel modal-panel" id="settingsPanel">
          <div class="form-header">
            <div>
              <div class="form-title">Settings</div>
              <div class="form-subtitle">Customize labels and granularity</div>
            </div>
            <button class="ghost small" id="closeSettingsBtn">Close</button>
          </div>
          <form id="settingsForm" class="blob-form">
            <div class="settings-tabs vertical" role="tablist">
              <button class="settings-tab active" type="button" data-settings-tab="general">
                General
              </button>
              <button class="settings-tab" type="button" data-settings-tab="scheduling">
                Scheduling
              </button>
            </div>
            <div class="settings-section active" data-settings-section="general">
              <label>
                Schedule name
                <input type="text" name="scheduleName" placeholder="Elastisched" />
              </label>
              <label>
                Subtitle
                <input type="text" name="subtitle" placeholder="Schedule at a glance" />
              </label>
              <label>
                User timezone
                <select name="userTimeZone"></select>
              </label>
            </div>
            <div class="settings-section" data-settings-section="scheduling">
              <label>
                Minute granularity
                <input type="number" name="minuteGranularity" min="1" step="1" />
              </label>
              <label>
                Finish early buffer (minutes)
                <input type="number" name="finishEarlyBufferMinutes" min="1" step="1" />
              </label>
              <label class="settings-toggle">
                <span>Reschedule ongoing events</span>
                <input type="checkbox" name="includeActiveOccurrences" />
              </label>
              <label>
                Lookahead minutes
                <input type="number" name="lookaheadMinutes" min="1" step="1" />
              </label>
            </div>
            <div class="form-actions">
              <button type="submit" class="primary">Save</button>
              <span class="form-status" id="settingsStatus"></span>
            </div>
          </form>
        </section>
      </div>

      <div class="modal" id="helpModal" aria-hidden="true">
        <div class="modal-backdrop" id="helpBackdrop"></div>
        <section class="panel form-panel modal-panel help-panel" id="helpPanel">
          <div class="form-header">
            <div>
              <div class="form-title">Keyboard shortcuts</div>
              <div class="form-subtitle">Quick actions without leaving the flow</div>
            </div>
            <button class="ghost small" id="closeHelpBtn">Close</button>
          </div>
          <div class="help-grid">
            <div class="help-item">
              <div class="help-action">Undo</div>
              <div class="help-keys"><kbd>Ctrl</kbd><span>+</span><kbd>Z</kbd></div>
            </div>
            <div class="help-item">
              <div class="help-action">Redo</div>
              <div class="help-keys"><kbd>Ctrl</kbd><span>+</span><kbd>Y</kbd></div>
            </div>
            <div class="help-item">
              <div class="help-action">Create new recurrence</div>
              <div class="help-keys"><kbd>N</kbd></div>
            </div>
            <div class="help-item">
              <div class="help-action">Previous / next period</div>
              <div class="help-keys"><kbd>‚Üê</kbd><span>/</span><kbd>‚Üí</kbd></div>
            </div>
            <div class="help-item">
              <div class="help-action">Close panels / clear lock</div>
              <div class="help-keys"><kbd>Esc</kbd></div>
            </div>
            <div class="help-item">
              <div class="help-action">Edit occurrence</div>
              <div class="help-keys"><kbd>Shift</kbd><span>+</span><kbd>Click</kbd></div>
            </div>
          </div>
        </section>
      </div>

      <section class="panel form-panel llm-panel" id="llmPanel">
        <div class="form-header">
          <div>
            <div class="form-title">Draft with AI</div>
            <div class="form-subtitle">Describe the events you want to schedule</div>
          </div>
          <button class="ghost small" id="closeLlmBtn">Close</button>
        </div>
        <form id="llmForm" class="blob-form">
          <label>
            What should be scheduled?
            <textarea name="llmPrompt" rows="5" placeholder="e.g. Deep work on thesis next Tue/Thu, 2-4pm, repeat for 3 weeks."></textarea>
          </label>
          <label>
            Extra context (optional)
            <textarea
              name="llmContext"
              rows="4"
              placeholder="Add details, constraints, or notes..."
            ></textarea>
          </label>
          <div class="form-actions">
            <button type="submit" class="primary" id="llmGenerateBtn">Generate preview</button>
            <button type="button" class="ghost" id="llmDiscardBtn">Discard preview</button>
            <button type="button" class="primary" id="llmConfirmBtn">Looks good</button>
            <span class="form-status" id="llmStatus"></span>
          </div>
        </form>
      </section>

      <div class="modal" id="alertModal" aria-hidden="true">
        <div class="modal-backdrop" id="alertBackdrop"></div>
        <section class="panel modal-panel alert-panel" id="alertPanel" role="dialog" aria-modal="true">
          <div class="form-header">
            <div>
              <div class="form-title" id="alertTitle">Notice</div>
            </div>
          </div>
          <div class="alert-message" id="alertMessage"></div>
          <div class="form-actions alert-actions">
            <button type="button" class="ghost alert-action cancel" id="alertCancelBtn">Cancel</button>
            <button type="button" class="ghost alert-action alt" id="alertAltBtn">Delete</button>
            <button type="button" class="primary alert-action confirm" id="alertConfirmBtn">OK</button>
          </div>
        </section>
      </div>

      <section class="panel form-panel" id="formPanel">
        <div class="form-header">
          <div>
            <div class="form-title" id="formTitle">Create a recurrence</div>
            <div class="form-subtitle">Set a one-time or repeating session</div>
          </div>
          <button class="ghost small" id="closeFormBtn">Close</button>
        </div>
        <form id="blobForm" class="blob-form">
          <label>
            Recurrence name
            <input type="text" name="recurrenceName" class="needs-input" />
          </label>
          <label>
            Recurrence description
            <input type="text" name="recurrenceDescription" class="needs-input" />
          </label>
          <label>
            AI context (optional)
            <textarea
              name="aiContext"
              rows="3"
              placeholder="Paste extra notes or constraints for AI..."
            ></textarea>
          </label>
          <label>
            Recurrence
            <select name="recurrenceType" id="recurrenceType">
              <option value="single">Single occurrence</option>
              <option value="multiple">Multiple occurrence</option>
              <option value="weekly">Weekly cadence</option>
              <option value="delta">Fixed interval</option>
              <option value="date">Annual date</option>
            </select>
          </label>
          <div class="recurrence-note" id="recurrenceSummary">
            One-time event. Switch to create repeats.
          </div>
          <div class="recurrence-fields" data-recurrence="multiple">
            <div class="recurrence-note subtle">
              Group one-time occurrences together. These do not repeat.
            </div>
            <div class="weekly-slots multiple-slots">
              <div class="weekly-slots-header">
                <span>Occurrences</span>
                <button type="button" class="ghost small" id="addMultipleSlotBtn">
                  Add occurrence
                </button>
              </div>
              <div class="weekly-slot-status" id="multipleSlotStatus"></div>
              <div id="multipleSlots"></div>
            </div>
          </div>
          <div class="recurrence-fields" data-recurrence="weekly">
            <div class="weekly-controls">
              <label>
                Repeat every (weeks)
                <input type="number" name="weeklyInterval" min="1" step="1" value="1" />
              </label>
              <label class="weekly-toggle">
                Customize each occurrence
                <input type="checkbox" name="weeklyPerSlot" id="weeklyPerSlot" />
              </label>
            </div>
            <div class="weekly-slots">
              <div class="weekly-slots-header">
                <span>Weekly occurrences</span>
                <button type="button" class="ghost small" id="addWeeklySlotBtn">
                  Add occurrence
                </button>
              </div>
              <div class="weekly-slot-status" id="weeklySlotStatus"></div>
              <div id="weeklySlots"></div>
            </div>
          </div>
          <div class="recurrence-fields" data-recurrence="delta">
            <label>
              Repeat every
              <div class="field-row">
                <input type="number" name="deltaValue" min="1" step="1" value="1" />
                <select name="deltaUnit">
                  <option value="minutes">Minutes</option>
                  <option value="hours">Hours</option>
                  <option value="days" selected>Days</option>
                  <option value="weeks">Weeks</option>
                </select>
              </div>
            </label>
          </div>
          <div class="recurrence-fields" data-recurrence="date">
            <div class="recurrence-note subtle">
              Repeats annually on the default start date.
            </div>
            <label>
              Annual date
              <div class="datetime-field" data-mode="date">
                <input
                  type="text"
                  class="datetime-display"
                  placeholder="Select date"
                  readonly
                />
                <button type="button" class="ghost small datetime-trigger" aria-label="Pick date">
                  üìÖ
                </button>
                <input type="hidden" name="annualDate" data-datetime-input />
              </div>
            </label>
          </div>
          <div class="recurrence-extras">
            <label>
              Recurrence ends
              <div class="datetime-field">
                <input
                  type="text"
                  class="datetime-display"
                  placeholder="Select date/time"
                  readonly
                />
                <button type="button" class="ghost small datetime-trigger" aria-label="Pick date">
                  üìÖ
                </button>
                <input type="hidden" name="recurrenceEnd" data-datetime-input />
              </div>
            </label>
          </div>
          <div class="non-weekly-field weekly-slot single-slot">
            <div class="weekly-slot-row blob-type-row">
              <div class="blob-type-toggle" role="group" aria-label="Occurrence type">
                <button type="button" class="type-pill active" data-blob-type="task" aria-pressed="true">
                  Task
                </button>
                <button type="button" class="type-pill" data-blob-type="event" aria-pressed="false">
                  Event
                </button>
              </div>
              <input type="hidden" name="blobType" id="blobTypeInput" value="task" data-blob-type-input />
            </div>
            <div class="weekly-slot-row time-range-row">
              <label>
                Schedulable start
                <div class="datetime-field">
                  <input
                    type="text"
                    class="datetime-display"
                    placeholder="Select date/time"
                    readonly
                  />
                  <button
                    type="button"
                    class="ghost small datetime-trigger"
                    aria-label="Pick date"
                  >
                    üìÖ
                  </button>
                  <input type="hidden" name="schedulableStart" required data-datetime-input />
                </div>
              </label>
              <label>
                Schedulable end
                <div class="datetime-field">
                  <input
                    type="text"
                    class="datetime-display"
                    placeholder="Select date/time"
                    readonly
                  />
                  <button
                    type="button"
                    class="ghost small datetime-trigger"
                    aria-label="Pick date"
                  >
                    üìÖ
                  </button>
                  <input type="hidden" name="schedulableEnd" required data-datetime-input />
                </div>
              </label>
            </div>
            <div class="weekly-slot-row time-range-row default-range-row">
              <label>
                Default start
                <div class="datetime-field">
                  <input
                    type="text"
                    class="datetime-display"
                    placeholder="Select date/time"
                    readonly
                  />
                  <button
                    type="button"
                    class="ghost small datetime-trigger"
                    aria-label="Pick date"
                  >
                    üìÖ
                  </button>
                  <input type="hidden" name="defaultStart" required data-datetime-input />
                </div>
              </label>
              <label>
                Default end
                <div class="datetime-field">
                  <input
                    type="text"
                    class="datetime-display"
                    placeholder="Select date/time"
                    readonly
                  />
                  <button
                    type="button"
                    class="ghost small datetime-trigger"
                    aria-label="Pick date"
                  >
                    üìÖ
                  </button>
                  <input type="hidden" name="defaultEnd" required data-datetime-input />
                </div>
              </label>
            </div>
            <div class="weekly-slot-row estimate-row">
              <button type="button" class="ghost" id="estimateDurationBtn">
                Estimate task duration
              </button>
              <span class="form-status" id="estimateStatus"></span>
            </div>
            <div class="weekly-slot-row slot-meta">
              <label>
                Occurrence name
                <input type="text" name="blobName" class="needs-input" required />
              </label>
              <label>
                Occurrence description
                <input type="text" name="blobDescription" class="needs-input" />
              </label>
            </div>
            <div class="weekly-slot-row policy-label-row">
              <span class="policy-label">Policy options</span>
            </div>
            <div class="weekly-slot-row slot-policy">
              <label class="policy-option policy-splittable">
                <input type="checkbox" name="policySplittable" />
                <span>Splittable</span>
              </label>
              <label class="policy-option">
                <input type="checkbox" name="policyOverlappable" />
                <span>Overlappable</span>
              </label>
              <label class="policy-option">
                <input type="checkbox" name="policyInvisible" />
                <span>Invisible</span>
              </label>
            </div>
            <div class="weekly-slot-row slot-policy-advanced is-hidden">
              <label>
                Max splits
                <input type="number" name="policyMaxSplits" min="0" step="1" value="1" />
              </label>
              <label>
                Min split duration (min)
                <input type="number" name="policyMinSplitDuration" min="0" step="1" value="15" />
              </label>
              <label class="policy-option">
                <input type="checkbox" name="policyRoundToGranularity" />
                <span>Round to granularity</span>
              </label>
            </div>
          </div>
          <div class="dependency-field">
            <span class="dependency-label">Dependencies</span>
            <div class="dependency-input-row">
              <input
                type="text"
                name="blobDependencyInput"
                class="needs-input"
                placeholder="Search by blob name or id"
                autocomplete="off"
              />
              <button
                type="button"
                class="ghost small"
                id="addDependencyBtn"
                aria-label="Add dependency"
                title="Add dependency"
              >
                +
              </button>
            </div>
            <div class="dependency-suggestions" id="dependencySuggestions"></div>
            <div class="dependency-list" id="dependencyList"></div>
          </div>
          <div class="tag-field" id="recurrenceTagField">
            <span class="tag-label">Tags</span>
            <div class="tag-input-row">
              <input
                type="text"
                name="blobTagInput"
                class="needs-input"
                placeholder="Search or add a tag"
                autocomplete="off"
              />
              <button
                type="button"
                class="ghost small"
                id="addTagBtn"
                aria-label="Add tag"
                title="Add tag"
              >
                +
              </button>
            </div>
            <div class="tag-suggestions" id="tagSuggestions"></div>
            <div class="tag-list" id="tagList"></div>
          </div>
          <div class="color-field">
            <span class="color-label">Color</span>
            <div class="color-swatches" role="radiogroup" aria-label="Recurrence color">
              <label class="color-swatch">
                <input
                  type="radio"
                  name="recurrenceColor"
                  value="default"
                  checked
                  aria-label="Default"
                />
                <span class="swatch swatch-default"></span>
              </label>
              <label class="color-swatch">
                <input type="radio" name="recurrenceColor" value="sand" aria-label="Sand" />
                <span class="swatch swatch-sand"></span>
              </label>
              <label class="color-swatch">
                <input type="radio" name="recurrenceColor" value="sage" aria-label="Sage" />
                <span class="swatch swatch-sage"></span>
              </label>
              <label class="color-swatch">
                <input type="radio" name="recurrenceColor" value="mist" aria-label="Mist" />
                <span class="swatch swatch-mist"></span>
              </label>
              <label class="color-swatch">
                <input type="radio" name="recurrenceColor" value="clay" aria-label="Clay" />
                <span class="swatch swatch-clay"></span>
              </label>
              <label class="color-swatch">
                <input type="radio" name="recurrenceColor" value="moss" aria-label="Moss" />
                <span class="swatch swatch-moss"></span>
              </label>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="ghost star edit-only" id="starOccurrenceBtn">
              Star occurrence
            </button>
            <button type="button" class="ghost star edit-only" id="starRecurrenceBtn">
              Star recurrence
            </button>
            <button type="button" class="ghost danger edit-only" id="deleteOccurrenceBtn">
              Delete occurrence
            </button>
            <button type="button" class="ghost danger edit-only" id="deleteRecurrenceBtn">
              Delete recurrence
            </button>
            <button type="submit" class="primary" id="formSubmitBtn">Create</button>
            <span class="form-status" id="formStatus"></span>
          </div>
        </form>
      </section>

      <section class="panel calendar-panel">
        <div class="tab-row">
          <div class="tabs" role="tablist">
            <button class="tab active" data-view="day">Day</button>
            <button class="tab" data-view="week">Week</button>
            <button class="tab" data-view="month">Month</button>
            <button class="tab" data-view="year">Year</button>
          </div>
          <div class="nav-actions">
            <button class="ghost icon" id="prevDayBtn" title="Previous day">&#8592;</button>
            <button class="ghost" id="goTodayBtn">Today</button>
            <button class="ghost icon" id="nextDayBtn" title="Next day">&#8594;</button>
          </div>
        </div>
        <div class="now-panel" id="nowPanel">
          <div class="now-meta">
            <div class="now-label">Now</div>
            <div class="now-time" id="nowTime">--:--</div>
            <div class="now-date" id="nowDate">--</div>
          </div>
          <div class="now-actions">
            <button class="ghost" id="finishNowBtn" disabled>Finish</button>
            <div class="add-time-menu">
              <button class="ghost" id="addTimeBtn" disabled>Add time</button>
              <div class="add-time-popover" id="addTimePopover" role="menu">
                <button class="add-time-option" type="button" data-add-minutes="1">
                  +1 min
                </button>
                <button class="add-time-option" type="button" data-add-minutes="5">
                  +5 min
                </button>
                <button class="add-time-option" type="button" data-add-minutes="10">
                  +10 min
                </button>
                <button class="add-time-option" type="button" data-add-minutes="30">
                  +30 min
                </button>
                <button class="add-time-option" type="button" data-add-minutes="60">
                  +60 min
                </button>
                <form class="add-time-form" id="addTimeForm">
                  <input
                    type="number"
                    name="addMinutes"
                    min="1"
                    step="1"
                    placeholder="Custom"
                    aria-label="Add minutes"
                  />
                  <button type="submit" class="ghost small">Apply</button>
                </form>
              </div>
            </div>
          </div>
          <div class="now-events" id="nowEvents"></div>
        </div>
        <div class="view-header">
          <div class="date-label" id="dateLabel">Tuesday, May 21</div>
          <div class="legend">
            <div class="schedule-controls">
              <button class="ghost" id="toggleFormBtn">Add recurrence</button>
              <button class="ghost" id="llmScheduleBtn">Add with AI</button>
              <button class="primary schedule-btn" id="runScheduleBtn">Run schedule</button>
              <div class="schedule-status" id="scheduleStatus" role="status" aria-live="polite">
                <span class="status-dot" aria-hidden="true"></span>
                <span class="status-text" id="scheduleStatusText">
                  Schedule status unknown
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="info-card" id="infoCard" aria-hidden="true"></div>

        <div class="views">
          <div id="viewDay" class="view active"></div>
          <div id="viewWeek" class="view"></div>
          <div id="viewMonth" class="view"></div>
          <div id="viewYear" class="view"></div>
        </div>
      </section>
    </div>

    <script src="./js/constants.js"></script>
    <script type="module" src="./js/app.js"></script>
  </body>
</html>
